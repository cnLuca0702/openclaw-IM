# OpenClaw IM 客户端产品需求文档 (PRD)

## 一、产品概述

### 1.1 产品名称
OpenClaw IM Client

### 1.2 产品定位
一款跨平台的桌面即时通讯客户端，用于管理多个 OpenClaw 实例的连接和会话，支持多类型文件传输和智能回复功能。

### 1.3 目标用户
- 运维工程师：需要同时管理多个 OpenClaw 服务器的连接
- 开发者：需要在本地与 OpenClaw 进行交互测试
- 系统管理员：需要监控和管理多个 OpenClaw 实例

### 1.4 核心价值
- **多连接管理**：统一管理多个 OpenClaw 连接，快速切换
- **便捷连接**：采用 Kimi Claw 式的一键连接方式
- **高效沟通**：支持多会话并发，实时消息收发
- **文件传输**：支持所有类型文件的上传和传输
- **智能辅助**：AI 辅助回复和模板回复提高沟通效率

---

## 二、功能需求

### 2.1 连接管理

#### 2.1.1 添加连接
**功能描述**：用户可以添加新的 OpenClaw 连接

**支持两种连接模式**：

**模式一：直接连接**
- 用户输入：
  - 连接名称（必填）
  - Bot Token（必填）
  - WebSocket 地址（可选，默认官方地址）
- 系统行为：
  - 使用 WebSocket 主动连接到 OpenClaw 服务器
  - 连接成功后显示连接状态

**模式二：服务器主动连接（反向连接）**
- 用户输入：
  - 连接名称（必填）
  - Bot Token（必填）
- 系统行为：
  - 生成 Kimi Claw 风格的 bash 连接命令：
    ```bash
    bash <(curl -fsSL https://cdn.kimi.com/kimi-claw/install.sh) --bot-token {token} --connection-name "{name}"
    ```
  - 显示三步操作指引：
    1. 复制命令
    2. 在 OpenClaw 服务器执行
    3. 点击"我已运行"按钮
  - 保存连接配置，状态设为"等待连接"
  - 用户点击"我已运行"后，开始监听服务器连接

#### 2.1.2 连接列表
**功能描述**：显示所有已添加的连接

- 显示内容：
  - 连接名称
  - 连接状态（已连接、连接中、等待连接、错误、已断开）
  - 最后错误信息（如有）
- 操作：
  - 点击切换激活连接
  - 删除连接（带确认）

#### 2.1.3 连接状态管理
- **已连接**：绿色指示器，可正常收发消息
- **连接中**：黄色指示器，正在建立连接
- **等待连接**：蓝色指示器，等待服务器主动连接
- **错误**：红色指示器，显示错误信息
- **已断开**：灰色指示器，连接已断开

### 2.2 会话管理

#### 2.2.1 会话列表
**功能描述**：显示当前激活连接的所有会话

- 显示内容：
  - 会话名称
  - 最后一条消息预览
  - 未读消息数量（角标显示）
- 操作：
  - 点击切换激活会话
  - 未读会话高亮显示

#### 2.2.2 会话状态
- 支持三种会话类型：
  - 个人会话（individual）
  - 群组会话（group）
  - 频道会话（channel）

### 2.3 消息功能

#### 2.3.1 发送消息
- 输入方式：
  - 文本输入框
  - Enter 发送，Shift+Enter 换行
- 消息类型：
  - 文本消息
  - 文件消息
- 消息状态：
  - 发送中
  - 已发送
  - 已送达
  - 已读
  - 发送失败

#### 2.3.2 接收消息
- 实时接收并显示消息
- 支持消息去重
- 自动滚动到最新消息

#### 2.3.3 消息显示
- 气泡式布局
- 区分发送方和接收方
- 显示时间戳
- 支持消息状态图标

### 2.4 文件传输

#### 2.4.1 支持的文件类型
- **图片**：jpg, jpeg, png, gif, bmp, webp, svg
- **文档**：pdf, doc, docx, xls, xlsx, ppt, pptx, txt
- **音频**：mp3, wav, ogg, aac, flac
- **视频**：mp4, avi, mkv, mov, wmv, flv
- **压缩包**：zip, rar, 7z, tar, gz
- **代码**：js, json, ts, py, java, cpp, c, go, rs, php

#### 2.4.2 上传方式
- 点击上传按钮选择文件
- 拖拽文件到聊天窗口
- 显示上传进度
- 支持取消上传

#### 2.4.3 文件显示
- 图片：缩略图预览，点击放大
- 其他文件：显示文件图标、名称、大小
- 支持下载/打开文件

### 2.5 智能回复

#### 2.5.1 AI 辅助回复
**功能描述**：基于上下文自动生成回复建议

- 触发方式：点击 AI 图标
- 分析内容：
  - 会话历史消息
  - 用户输入的提示词（可选）
- 返回结果：
  - 多条回复建议
  - 每条建议附带置信度
  - 一键插入建议到输入框

#### 2.5.2 模板回复
**功能描述**：使用预设模板快速回复

- 模板管理：
  - 创建模板
  - 编辑模板
  - 删除模板
  - 模板分类和标签

- 模板内容：
  - 模板名称
  - 模板内容
  - 支持变量：{{date}}、{{time}}、{{timestamp}}
  - 分类标签

- 使用方式：
  - 点击模板图标
  - 搜索或选择模板
  - 一键插入到输入框

### 2.6 界面功能

#### 2.6.1 主题切换
- 支持浅色主题
- 支持深色主题
- 记忆用户选择

#### 2.6.2 侧边栏
- 可折叠/展开
- 快捷操作按钮：
  - 添加连接
  - 管理模板
  - 主题切换
  - 设置

#### 2.6.3 设置面板
- 应用信息显示
- 主题选择
- 关于信息

---

## 三、非功能需求

### 3.1 性能要求
- 消息接收延迟 < 1 秒
- 文件上传速度取决于网络，不占用过多系统资源
- 支持同时管理 10+ 个连接
- 支持单连接 100+ 条消息加载

### 3.2 兼容性要求
- **操作系统**：
  - Windows 10/11
  - macOS 10.15+
  - Ubuntu 20.04+
- **屏幕分辨率**：最低 1280×720

### 3.3 安全要求
- Bot Token 本地加密存储
- 通信使用 WebSocket 加密连接
- 文件传输前进行病毒扫描提示

### 3.4 可用性要求
- 界面简洁直观
- 操作流程不超过 3 步
- 提供操作反馈（成功/失败提示）
- 错误信息清晰易懂

---

## 四、技术方案

### 4.1 技术栈
- **桌面框架**：Electron
- **前端框架**：React 18 + TypeScript
- **构建工具**：Vite
- **状态管理**：Zustand
- **通信协议**：WebSocket
- **数据存储**：electron-store

### 4.2 架构设计

```
┌─────────────────────────────────────────┐
│           Electron 主进程               │
│  - 窗口管理                             │
│  - IPC 通信                             │
│  - 本地数据持久化                       │
└─────────────────────────────────────────┘
                  ↕ IPC
┌─────────────────────────────────────────┐
│           Renderer 进程                 │
│  ┌──────────┐  ┌──────────┐            │
│  │ 组件层   │  │ 状态管理 │            │
│  └──────────┘  └──────────┘            │
│  ┌──────────┐  ┌──────────┐            │
│  │ 服务层   │  │ 类型定义 │            │
│  └──────────┘  └──────────┘            │
└─────────────────────────────────────────┘
                  ↕ WebSocket
┌─────────────────────────────────────────┐
│         OpenClaw 服务器                 │
└─────────────────────────────────────────┘
```

### 4.3 数据流

#### 4.3.1 直接连接模式
```
IM 客户端 → WebSocket → OpenClaw 服务器
     ↓
    认证 (Bot Token)
     ↓
    建立连接
     ↓
    收发消息
```

#### 4.3.2 反向连接模式
```
1. 用户填写连接信息
     ↓
2. 生成 bash 连接命令
     ↓
3. 用户在服务器执行命令
     ↓
4. OpenClaw 服务器 → WebSocket → IM 客户端
     ↓
5. 建立连接
     ↓
6. 收发消息
```

---

## 五、用户流程

### 5.1 首次使用流程
1. 启动应用
2. 点击"+"按钮添加连接
3. 选择连接模式（直接连接 / 服务器主动连接）
4. 填写连接信息
5. 完成连接
6. 开始使用

### 5.2 服务器主动连接流程
1. 添加连接，选择"服务器主动连接"
2. 填写连接名称和 Bot Token
3. 复制显示的 bash 命令
4. 登录到 OpenClaw 服务器
5. 执行复制的命令
6. 返回 IM 客户端
7. 点击"我已运行"按钮
8. 等待服务器连接
9. 连接成功

### 5.3 发送消息流程
1. 选择连接和会话
2. 在输入框输入消息
3. 按 Enter 发送
4. 消息显示在聊天窗口
5. 等待对方回复

### 5.4 文件上传流程
1. 点击上传按钮或拖拽文件
2. 选择文件
3. 显示上传进度
4. 上传完成
5. 文件显示在聊天窗口

---

## 六、界面原型

### 6.1 主界面布局
```
┌──────────────────────────────────────────────┐
│  ┌──┐  OpenClaw IM                    □ ─ ✕ │
│  │◀│  ──────────────────────────────────────  │
│  └──┦                                         │
│     ┃  连接列表                               │
│     ┃  ┌─────────────────┐                   │
│     ┃  │ 🟢 生产环境     │                   │
│     ┃  └─────────────────┘                   │
│     ┃  ┌─────────────────┐                   │
│     ┃  │ 🔴 测试环境     │                   │
│     ┃  └─────────────────┘                   │
│     ┠─────────────────────────────────────  │
│     ┃  会话                                   │
│     ┃  ┌─────────────────┐                   │
│     ┃  │ 💬 运维群 (3)   │                   │
│     ┃  └─────────────────┘                   │
│     ┃  ┌─────────────────┐                   │
│     ┃  │ 💬 开发组       │                   │
│     ┃  └─────────────────┘                   │
│     ┠─────────────────────────────────────  │
│     ┃  ┌─────────────────────────────────┐  │
│     ┃  │  +  📝  🌙  ⚙️                   │  │
│     ┃  └─────────────────────────────────┘  │
└─────┴───────────────────┴────────────────────┘
┌──────────────────────────────────────────────┐
│  运维群                          🔍 ⋮        │
│  ───────────────────────────────────────────  │
│  ┌────────────────────────────────────────┐  │
│  │ 张三  14:30                              │  │
│  │ 你好，服务器需要重启吗？                  │  │
│  └────────────────────────────────────────┘  │
│  ┌────────────────────────────────────────┐  │
│  │        14:31                              │  │
│  │ 我检查一下，稍等                          │  │
│  └────────────────────────────────────────┘  │
│  ┌────────────────────────────────────────┐  │
│  │ 张三  14:32                              │  │
│  │ 好的                                     │  │
│  └────────────────────────────────────────┘  │
│                                              │
│  ┌────────────────────────────────────────┐  │
│  │ 📎  🤖  📝                              │  │
│  │ 输入消息...                    Enter发送 │  │
│  └────────────────────────────────────────┘  │
└──────────────────────────────────────────────┘
```

### 6.2 添加连接对话框
```
┌─────────────────────────────────────┐
│  添加 OpenClaw 连接            ✕    │
│  ─────────────────────────────────  │
│                                       │
│  连接方式                              │
│  ┌──────────┐  ┌──────────┐          │
│  │ 📡 直接  │  │ 🔄 服务器 │          │
│  │  连接    │  │  主动连接 │          │
│  └──────────┘  └──────────┘          │
│                                       │
│  连接名称 *                            │
│  ┌─────────────────────────────────┐  │
│  │ 例如：生产环境、测试机器人        │  │
│  └─────────────────────────────────┘  │
│                                       │
│  Bot Token *                          │
│  ┌─────────────────────────────────┐  │
│  │ sk-xxxxxxxxxxxxxxxxxxxxxxx       │  │
│  └─────────────────────────────────┘  │
│  在 OpenClaw 管理后台获取             │
│                                       │
│  ┌─────────────────────────────────┐  │
│  │  📋 第一步：复制以下命令          │  │
│  ├─────────────────────────────────┤  │
│  │ bash <(curl -fsSL               │  │
│  │   https://cdn.kimi.com/...)     │  │
│  │   --bot-token sk-xxx...         │  │
│  │   --connection-name "生产环境"  │  │
│  ├─────────────────────────────────┤  │
│  │     [📋 复制命令]                │  │
│  │                                  │  │
│  │  📌 使用步骤：                   │  │
│  │  1. 复制上面的命令               │  │
│  │  2. 在 OpenClaw 服务器上执行     │  │
│  │  3. 看到连接成功提示后，         │  │
│  │     点击下方"我已运行"按钮       │  │
│  └─────────────────────────────────┘  │
│                                       │
│  ┌────────────────┐  ┌───────────┐  │
│  │   ➡️ 下一步    │  │   取消     │  │
│  └────────────────┘  └───────────┘  │
└─────────────────────────────────────┘
```

### 6.3 模板管理对话框
```
┌─────────────────────────────────────┐
│  回复模板管理                   ✕   │
│  ─────────────────────────────────  │
│                                       │
│  ┌────────────┐  ┌─────────────┐    │
│  │ 新建模板   │  │  🔍 搜索   │    │
│  └────────────┘  └─────────────┘    │
│                                       │
│  分类：[全部 ▼]                       │
│                                       │
│  ┌─────────────────────────────────┐ │
│  │ 问候语                            │ │
│  │ 您好，有什么可以帮您的？          │ │
│  │ #客服 #常用                        │ │
│  │                      [编辑] [删除]│ │
│  ├─────────────────────────────────┤ │
│  │ 确认收到                          │ │
│  │ 收到，我会尽快处理。              │ │
│  │ #确认                             │ │
│  │                      [编辑] [删除]│ │
│  └─────────────────────────────────┘ │
│                                       │
│  ┌────────────┐  ┌───────────┐      │
│  │    关闭    │  │  新建模板 │      │
│  └────────────┘  └───────────┘      │
└─────────────────────────────────────┘
```

---

## 七、开发计划

### 7.1 已完成功能 ✅
- [x] 基础 UI 界面
- [x] WebSocket 连接
- [x] 多连接管理
- [x] 直接连接模式
- [x] 服务器主动连接模式（Kimi Claw 风格）
- [x] 文件上传基础功能
- [x] 模板回复基础功能
- [x] AI 辅助回复基础功能
- [x] 主题切换（浅色/深色）

### 7.2 待开发功能 📋
- [ ] 消息加密传输
- [ ] 表情包支持
- [ ] 语音消息
- [ ] 截图功能
- [ ] 消息搜索
- [ ] 聊天记录导出
- [ ] 消息通知提醒
- [ ] 快捷键支持
- [ ] 连接自动重连
- [ ] 文件传输断点续传

---

## 八、版本规划

### V1.0（当前版本）
**发布内容**：
- 基础 IM 功能
- 直接连接和反向连接两种模式
- 文件传输
- 模板回复和 AI 辅助回复
- 主题切换

### V1.1（计划中）
**计划内容**：
- 消息搜索功能
- 聊天记录导出
- 连接自动重连
- 消息通知提醒

### V2.0（未来规划）
**计划内容**：
- 消息加密
- 语音消息
- 截图功能
- 表情包支持

---

## 九、风险评估

### 9.1 技术风险
| 风险 | 影响 | 应对措施 |
|------|------|----------|
| WebSocket 连接不稳定 | 高 | 实现自动重连机制 |
| 文件传输失败 | 中 | 提供重试和断点续传 |
| 跨平台兼容性问题 | 中 | 充分测试各平台 |

### 9.2 产品风险
| 风险 | 影响 | 应对措施 |
|------|------|----------|
| OpenClaw API 变更 | 高 | 版本控制和兼容性检查 |
| 用户学习成本 | 中 | 提供详细使用说明 |

---

## 十、成功指标

### 10.1 功能指标
- 支持同时管理 10+ 个连接
- 消息延迟 < 1 秒
- 文件上传成功率 > 99%

### 10.2 性能指标
- 应用启动时间 < 3 秒
- 内存占用 < 500MB
- CPU 占用 < 10%

### 10.3 用户体验指标
- 界面响应时间 < 100ms
- 操作流程 ≤ 3 步
- 错误恢复成功率 > 95%

---

## 附录

### A. 术语表
- **OpenClaw**：目标连接的服务端系统
- **Bot Token**：用于身份认证的令牌
- **WebSocket**：一种全双工通信协议
- **反向连接**：服务器主动连接到客户端的模式

### B. 参考资料
- [Electron 官方文档](https://www.electronjs.org/)
- [React 官方文档](https://react.dev/)
- [Kimi Claw 连接方式](https://cdn.kimi.com/kimi-claw/install.sh)

### C. 变更记录
| 版本 | 日期 | 变更内容 | 作者 |
|------|------|----------|------|
| 1.0 | 2025-02-27 | 初始版本 | Yao OQiang |
